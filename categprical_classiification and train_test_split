from keras.utils import to_categorical
from keras.models import Sequential
from keras.layers import Dense
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split

import pandas as pd
import numpy as np

path = r"C:\Users\Elçin YILDIZ\OneDrive\Desktop\diagnosed_cbc_data_v4.csv"

df = pd.read_csv(path)

y = df['Diagnosis']
x = df.drop(['Diagnosis'],axis=1)

le = LabelEncoder()
y = le.fit_transform(y)

y = to_categorical(y)

x_train,x_test,y_train,y_test = train_test_split(x,y,train_size=0.25,test_size=0.4)

model = Sequential()

model.add(Dense(256,activation='relu',input_dim=len(x.columns)))
model.add(Dense(128,activation='relu'))
model.add(Dense(64,activation='relu'))
model.add(Dense(9,activation='softmax'))

model.compile(optimizer='adam',loss='categorical_crossentropy',metrics=['accuracy'])
model.fit(x_train,y_train,batch_size=16,epochs=128)

a = x.head(1).to_numpy().astype('float32')          #x değişkenindeki df den 1. satırı alıyoruz

f = model.predict(a)                                #modelin tahmin(prediction) yapmasını sağlayan fonksiyon

k = np.argmax(f)                                    #dizideki en büyük(baskın) değerin indexini verir 

print(k)

print(le.inverse_transform([k]))                    #LabelEncoder ile inverse_transform uygulayarak numerik veriyi strine çeviriyoruz


